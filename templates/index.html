<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>NexOp Alerts Dashboard</title>
		<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
		<style>
			:root {
				/* Light mode colors */
				--bg-color-light: #f9fafb;
				--text-color-light: #111827;
				--card-bg-light: #ffffff;
				--card-shadow-light: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
				--input-bg-light: #ffffff;
				--input-border-light: #e2e8f0;
				--table-header-bg-light: #f9fafb;
				--table-border-light: #e5e7eb;
				--table-hover-light: #f3f4f6;
				--filter-bg-light: #ebf5ff;

				/* Dark mode colors */
				--bg-color-dark: #111827;
				--text-color-dark: #f3f4f6;
				--card-bg-dark: #1f2937;
				--card-shadow-dark: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
				--input-bg-dark: #374151;
				--input-border-dark: #4b5563;
				--table-header-bg-dark: #1f2937;
				--table-border-dark: #374151;
				--table-hover-dark: #2d3748;
				--filter-bg-dark: #1e3a8a;

				/* Gradient colors (same for both modes) */
				--gradient-start: #4f46e5;
				--gradient-end: #3b82f6;
			}

			body {
				font-family: "Inter", sans-serif;
				transition: background-color 0.3s, color 0.3s;
			}

			body.dark-mode {
				background-color: var(--bg-color-dark);
				color: var(--text-color-dark);
			}

			body.light-mode {
				background-color: var(--bg-color-light);
				color: var(--text-color-light);
			}

			/* Gradient Background */
			.gradient-bg {
				background: linear-gradient(90deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
			}

			/* Card Styles */
			.card {
				border-radius: 0.75rem;
				transition: all 0.3s ease;
				overflow: hidden;
			}

			.dark-mode .card {
				background-color: var(--card-bg-dark);
				box-shadow: var(--card-shadow-dark);
			}

			.light-mode .card {
				background-color: var(--card-bg-light);
				box-shadow: var(--card-shadow-light);
			}

			.dark-mode .card:hover {
				box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
			}

			.light-mode .card:hover {
				box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
			}
			/* Button Styles */
			.btn {
				transition: all 0.2s ease;
				border-radius: 0.5rem;
				font-weight: 500;
			}
			.btn:hover {
				transform: translateY(-1px);
			}
			.btn:active {
				transform: translateY(0);
			}

			/* Input Styles */
			.input-focus {
				transition: all 0.2s;
			}

			.dark-mode .input-focus {
				border: 1px solid var(--input-border-dark);
				background-color: var(--input-bg-dark);
				color: var(--text-color-dark);
			}

			.light-mode .input-focus {
				border: 1px solid var(--input-border-light);
				background-color: var(--input-bg-light);
				color: var(--text-color-light);
			}

			.dark-mode .input-focus:focus {
				border-color: var(--gradient-end);
				box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
			}

			.light-mode .input-focus:focus {
				border-color: var(--gradient-end);
				box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
			}

			/* Table Styles */
			.table-header {
				font-size: 0.75rem;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.05em;
				transition: background-color 0.3s, color 0.3s, border-color 0.3s;
			}

			.dark-mode .table-header {
				background-color: var(--table-header-bg-dark);
				border-bottom: 1px solid var(--table-border-dark);
				color: #9ca3af;
			}

			.light-mode .table-header {
				background-color: var(--table-header-bg-light);
				border-bottom: 1px solid var(--table-border-light);
				color: #4b5563;
			}

			tbody tr {
				transition: background-color 0.2s, border-color 0.3s;
			}

			.dark-mode tbody tr {
				border-bottom: 1px solid var(--table-border-dark);
			}

			.light-mode tbody tr {
				border-bottom: 1px solid var(--table-border-light);
			}

			.dark-mode tbody tr:hover {
				background-color: var(--table-hover-dark);
			}

			.light-mode tbody tr:hover {
				background-color: var(--table-hover-light);
			}

			/* Dark mode table styles */
			.dark-mode .dark-mode-table {
				background-color: var(--card-bg-dark);
				color: var(--text-color-dark);
			}

			.light-mode .dark-mode-table {
				background-color: white;
				color: var(--text-color-light);
			}

			.dark-mode .loading-text {
				color: #9ca3af;
			}

			.light-mode .loading-text {
				color: #6b7280;
			}

			/* Heading text styles */
			.dark-mode .heading-text {
				color: #e5e7eb;
			}

			.light-mode .heading-text {
				color: #1f2937;
			}
			.btn:hover {
				transform: translateY(-1px);
			}
			.btn:active {
				transform: translateY(1px);
			}
			.table-header {
				background: linear-gradient(90deg, #2563eb, #3b82f6);
				color: white;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.05em;
				font-size: 0.75rem;
			}
			.table-row:hover {
				background-color: #f3f4f6;
			}
			.badge {
				padding: 0.25rem 0.75rem;
				border-radius: 9999px;
				font-size: 0.75rem;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.05em;
			}

			.dark-mode .badge-remote {
				background-color: rgba(22, 101, 52, 0.3);
				color: #4ade80;
			}

			.light-mode .badge-remote {
				background-color: #dcfce7;
				color: #166534;
			}

			.dark-mode .badge-onsite {
				background-color: rgba(3, 105, 161, 0.3);
				color: #38bdf8;
			}

			.light-mode .badge-onsite {
				background-color: #e0f2fe;
				color: #0369a1;
			}
			.pagination-btn {
				transition: all 0.2s ease;
			}

			.dark-mode .pagination-btn {
				background-color: var(--card-bg-dark);
				border-color: var(--table-border-dark);
				color: var(--text-color-dark);
			}

			.light-mode .pagination-btn {
				background-color: white;
				border-color: var(--table-border-light);
				color: var(--text-color-light);
			}

			.pagination-btn:hover:not(:disabled) {
				transform: translateY(-1px);
			}

			.dark-mode .pagination-btn:hover:not(:disabled) {
				background-color: var(--table-hover-dark);
			}

			.light-mode .pagination-btn:hover:not(:disabled) {
				background-color: #f3f4f6;
			}

			.pagination-btn:active:not(:disabled) {
				transform: translateY(1px);
			}
			.gradient-bg {
				background: linear-gradient(135deg, #3b82f6, #2563eb);
			}
			.input-focus {
				transition: all 0.3s ease;
				border: 1px solid #d1d5db;
			}
			.input-focus:focus {
				border-color: #3b82f6;
				box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
			}
			.animate-pulse {
				animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
			}
			@keyframes pulse {
				0%,
				100% {
					opacity: 1;
				}
				50% {
					opacity: 0.7;
				}
			}

			/* Dark Mode Toggle */
			.theme-toggle {
				position: fixed;
				bottom: 20px;
				right: 20px;
				width: 50px;
				height: 50px;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				cursor: pointer;
				z-index: 1000;
				transition: all 0.3s ease;
				box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
			}

			.dark-mode .theme-toggle {
				background-color: #f3f4f6;
				color: #111827;
			}

			.light-mode .theme-toggle {
				background-color: #1f2937;
				color: #f3f4f6;
			}

			.theme-toggle:hover {
				transform: scale(1.1);
			}
		</style>
	</head>
	<body>
		<header class="gradient-bg py-6 shadow-lg mb-8">
			<div class="container mx-auto px-4">
				<div class="flex justify-between items-center">
					<div class="flex items-center space-x-3">
						<i class="fas fa-search-dollar text-white text-3xl"></i>
						<h1 class="text-3xl font-bold text-white">NexOp Alerts</h1>
					</div>
					<div class="text-white text-sm">
						<div class="flex items-center space-x-2">
							<i class="fas fa-clock"></i>
							<span id="currentDateTime"></span>
						</div>
					</div>
				</div>
			</div>
		</header>

		<div class="container mx-auto px-4 pb-12">
			<div class="flex flex-wrap -mx-4 mb-8">
				<div class="w-full md:w-1/3 px-4 mb-4">
					<div class="card p-6">
						<div class="flex items-center justify-between mb-4">
							<h3 class="text-lg font-semibold heading-text">Status</h3>
							<i class="fas fa-heartbeat text-blue-500 text-xl"></i>
						</div>
						<p
							id="scraperStatus"
							class="text-center py-3 font-medium rounded-lg {% if is_running %}bg-green-100 text-green-800{% else %}bg-yellow-100 text-yellow-800{% endif %}"
						>
							<i
								class="fas {% if is_running %}fa-play-circle text-green-600{% else %}fa-pause-circle text-yellow-600{% endif %} mr-2"
							></i>
							Scraper {% if is_running %}Running{% else %}Stopped{% endif %}
						</p>
						<div class="flex items-center justify-between mt-4 space-x-2">
							<button
								id="startScraper"
								class="btn flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded focus:outline-none focus:shadow-outline"
							>
								<i class="fas fa-play mr-2"></i> Start
							</button>
							<button
								id="stopScraper"
								class="btn flex-1 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded focus:outline-none focus:shadow-outline"
							>
								<i class="fas fa-stop mr-2"></i> Stop
							</button>
						</div>
					</div>
				</div>

				<div class="w-full md:w-2/3 px-4 mb-4">
					<div class="card p-6">
						<div class="flex items-center justify-between mb-4">
							<h3 class="text-lg font-semibold heading-text">Job Statistics</h3>
							<i class="fas fa-chart-bar text-blue-500 text-xl"></i>
						</div>
						<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
							<div class="bg-blue-50 rounded-lg p-4 text-center">
								<h4 class="text-sm font-medium text-blue-800 mb-1">Total Jobs</h4>
								<p id="totalJobsCount" class="text-2xl font-bold text-blue-600">--</p>
							</div>
							<div class="bg-green-50 rounded-lg p-4 text-center">
								<h4 class="text-sm font-medium text-green-800 mb-1">Remote Jobs</h4>
								<p id="remoteJobsCount" class="text-2xl font-bold text-green-600">--</p>
							</div>
							<div class="bg-purple-50 rounded-lg p-4 text-center">
								<h4 class="text-sm font-medium text-purple-800 mb-1">Recent Jobs (24h)</h4>
								<p id="recentJobsCount" class="text-2xl font-bold text-purple-600">--</p>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="card p-0 mb-8 overflow-hidden">
				<div class="gradient-bg px-6 py-4">
					<div class="flex justify-between items-center">
						<div class="flex items-center space-x-3">
							<i class="fas fa-briefcase text-white text-xl"></i>
							<h2 class="text-xl font-semibold text-white">Job Opportunities</h2>
						</div>
						<button
							id="refreshJobs"
							class="btn bg-white text-blue-600 hover:bg-blue-50 py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 flex items-center space-x-2"
						>
							<i class="fas fa-sync-alt"></i>
							<span>Refresh</span>
						</button>
					</div>
				</div>

				<div class="p-6">
					<div class="bg-blue-50 rounded-lg p-4 mb-6 flex flex-wrap items-center">
						<div class="w-full md:w-1/3 px-2 mb-2 md:mb-0">
							<div class="relative">
								<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
									<i class="fas fa-search text-gray-400"></i>
								</div>
								<input
									id="searchInput"
									type="text"
									placeholder="Search jobs..."
									class="input-focus pl-10 w-full py-2 px-3 rounded-lg text-gray-700 focus:outline-none"
								/>
							</div>
						</div>
						<div class="w-full md:w-1/3 px-2 mb-2 md:mb-0">
							<div class="relative">
								<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
									<i class="fas fa-laptop-house text-gray-400"></i>
								</div>
								<select
									id="remoteFilter"
									class="input-focus pl-10 w-full py-2 px-3 rounded-lg text-gray-700 focus:outline-none appearance-none"
								>
									<option value="all">All Jobs</option>
									<option value="remote">Remote Only</option>
									<option value="non-remote">On-site Only</option>
								</select>
								<div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
									<i class="fas fa-chevron-down text-gray-400"></i>
								</div>
							</div>
						</div>
						<div class="w-full md:w-1/3 px-2 mb-2 md:mb-0">
							<div class="relative">
								<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
									<i class="fas fa-sort text-gray-400"></i>
								</div>
								<select
									id="sortBy"
									class="input-focus pl-10 w-full py-2 px-3 rounded-lg text-gray-700 focus:outline-none appearance-none"
								>
									<option value="date">Sort by Date (Newest)</option>
									<option value="date-asc">Sort by Date (Oldest)</option>
									<option value="company">Sort by Company</option>
									<option value="title">Sort by Title</option>
								</select>
								<div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
									<i class="fas fa-chevron-down text-gray-400"></i>
								</div>
							</div>
						</div>
					</div>

					<div class="overflow-x-auto rounded-lg shadow">
						<table class="min-w-full dark-mode-table">
							<thead>
								<tr>
									<th class="table-header py-3 px-4 text-left">Title</th>
									<th class="table-header py-3 px-4 text-left">Company</th>
									<th class="table-header py-3 px-4 text-left">Location</th>
									<th class="table-header py-3 px-4 text-left">Date Posted</th>
									<th class="table-header py-3 px-4 text-left">Job Type</th>
									<th class="table-header py-3 px-4 text-left">Remote</th>
									<th class="table-header py-3 px-4 text-left">Actions</th>
								</tr>
							</thead>
							<tbody id="jobsTableBody">
								<tr>
									<td colspan="7" class="py-8 px-4 text-center loading-text">
										<div class="animate-pulse flex flex-col items-center">
											<i class="fas fa-spinner fa-spin text-blue-500 text-2xl mb-2"></i>
											<p>Loading job opportunities...</p>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
					</div>

					<div id="pagination" class="flex flex-col md:flex-row items-center justify-between mt-6 px-2">
						<div class="mb-4 md:mb-0">
							<span id="pageInfo" class="text-sm text-gray-600"
								>Showing <span id="startItem" class="font-semibold">0</span> to <span id="endItem" class="font-semibold">0</span> of
								<span id="totalItems" class="font-semibold">0</span> opportunities</span
							>
						</div>
						<div class="flex items-center space-x-2">
							<button
								id="prevPage"
								class="pagination-btn flex items-center space-x-1 bg-white border border-gray-300 text-gray-700 py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 disabled:opacity-50 disabled:cursor-not-allowed"
								disabled
							>
								<i class="fas fa-chevron-left text-xs"></i>
								<span>Previous</span>
							</button>
							<div id="pageNumbers" class="flex space-x-1"></div>
							<button
								id="nextPage"
								class="pagination-btn flex items-center space-x-1 bg-white border border-gray-300 text-gray-700 py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 disabled:opacity-50 disabled:cursor-not-allowed"
								disabled
							>
								<span>Next</span>
								<i class="fas fa-chevron-right text-xs"></i>
							</button>
						</div>
					</div>
				</div>
			</div>

			<div class="card p-0 mb-8 overflow-hidden">
				<div class="gradient-bg px-6 py-4">
					<div class="flex items-center space-x-3">
						<i class="fas fa-cog text-white text-xl"></i>
						<h2 class="text-xl font-semibold text-white">Search Configuration</h2>
					</div>
				</div>

				<div class="p-6">
					<form id="configForm" class="space-y-6">
						<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
							<div class="space-y-4">
								<div>
									<label class="flex items-center space-x-2 text-gray-700 text-sm font-medium mb-2" for="search_terms">
										<i class="fas fa-search text-blue-500"></i>
										<span>Search Terms (comma-separated)</span>
									</label>
									<input
										class="input-focus w-full py-2 px-3 rounded-lg text-gray-700"
										id="search_terms"
										name="search_terms"
										type="text"
										value="{{ ','.join(config['search_terms']) }}"
										placeholder="e.g. software engineer, developer, data scientist"
									/>
								</div>

								<div>
									<label class="flex items-center space-x-2 text-gray-700 text-sm font-medium mb-2" for="location">
										<i class="fas fa-map-marker-alt text-blue-500"></i>
										<span>Location</span>
									</label>
									<input
										class="input-focus w-full py-2 px-3 rounded-lg text-gray-700"
										id="location"
										name="location"
										type="text"
										value="{{ config['location'] }}"
										placeholder="e.g. New York, Remote"
									/>
								</div>

								<div>
									<label class="flex items-center space-x-2 text-gray-700 text-sm font-medium mb-2" for="interval_run">
										<i class="fas fa-clock text-blue-500"></i>
										<span>Run Interval (minutes)</span>
									</label>
									<input
										class="input-focus w-full py-2 px-3 rounded-lg text-gray-700"
										id="interval_run"
										name="interval_run"
										type="number"
										value="{{ config['interval_run'] }}"
										min="5"
										max="1440"
									/>
									<p class="mt-1 text-xs text-gray-500">How often the scraper should run (minimum 5 minutes)</p>
								</div>
							</div>

							<div class="space-y-4">
								<div>
									<label class="flex items-center space-x-2 text-gray-700 text-sm font-medium mb-2" for="filter_companies">
										<i class="fas fa-building text-blue-500"></i>
										<span>Companies to Filter Out</span>
									</label>
									<textarea
										class="input-focus w-full py-2 px-3 rounded-lg text-gray-700 h-24"
										id="filter_companies"
										name="filter_companies"
										placeholder="e.g. Company A, Company B"
									>
{{ ','.join(config['filter_companies']) }}</textarea
									>
									<p class="mt-1 text-xs text-gray-500">Comma-separated list of companies to exclude from results</p>
								</div>

								<div>
									<label class="flex items-center space-x-2 text-gray-700 text-sm font-medium mb-2" for="filter_words">
										<i class="fas fa-filter text-blue-500"></i>
										<span>Words to Filter Out</span>
									</label>
									<textarea
										class="input-focus w-full py-2 px-3 rounded-lg text-gray-700 h-24"
										id="filter_words"
										name="filter_words"
										placeholder="e.g. senior, lead, manager"
									>
{{ ','.join(config['filter_words']) }}</textarea
									>
									<p class="mt-1 text-xs text-gray-500">Comma-separated list of keywords to exclude from results</p>
								</div>
							</div>
						</div>

						<div class="pt-4 border-t border-gray-200">
							<button
								class="btn bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 flex items-center space-x-2"
								type="submit"
							>
								<i class="fas fa-save"></i>
								<span>Save Configuration</span>
							</button>
						</div>
					</form>
				</div>
			</div>

			<div class="card p-0 mb-8 overflow-hidden">
				<div class="gradient-bg px-6 py-4">
					<div class="flex items-center space-x-3">
						<i class="fas fa-play-circle text-white text-xl"></i>
						<h2 class="text-xl font-semibold text-white">Scraper Controls</h2>
					</div>
				</div>

				<div class="p-6">
					<div class="flex flex-col sm:flex-row sm:items-center space-y-4 sm:space-y-0 sm:space-x-4">
						<button
							id="startScraper"
							class="btn bg-green-600 hover:bg-green-700 text-white py-3 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 flex items-center justify-center space-x-2 transition-all duration-200 ease-in-out transform hover:scale-105"
						>
							<i class="fas fa-play"></i>
							<span>Start Job Scraper</span>
						</button>
						<button
							id="stopScraper"
							class="btn bg-red-600 hover:bg-red-700 text-white py-3 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 flex items-center justify-center space-x-2 transition-all duration-200 ease-in-out transform hover:scale-105"
						>
							<i class="fas fa-stop"></i>
							<span>Stop Job Scraper</span>
						</button>
						<div class="flex-grow"></div>
						<div class="flex items-center">
							<div class="flex items-center space-x-2 text-gray-700">
								<span class="text-sm font-medium">Status:</span>
								<span
									id="scraperStatus"
									class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium {% if is_running %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}"
								>
									<span class="h-2 w-2 rounded-full mr-1.5 {% if is_running %}bg-green-500{% else %}bg-red-500{% endif %}"></span>
									{% if is_running %}Running{% else %}Stopped{% endif %}
								</span>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="card p-0 mb-8 overflow-hidden">
				<div class="gradient-bg px-6 py-4">
					<div class="flex items-center justify-between">
						<div class="flex items-center space-x-3">
							<i class="fas fa-terminal text-white text-xl"></i>
							<h2 class="text-xl font-semibold text-white">Scraper Logs</h2>
						</div>
						<button
							id="clearLogs"
							class="btn bg-white text-blue-600 hover:bg-blue-50 py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 flex items-center space-x-2"
						>
							<i class="fas fa-trash-alt"></i>
							<span>Clear</span>
						</button>
					</div>
				</div>

				<div class="p-6">
					<div class="relative">
						<pre id="logOutput" class="font-mono text-sm bg-gray-900 text-gray-200 p-4 rounded-lg h-80 overflow-auto"></pre>
						<div
							id="emptyLogMessage"
							class="absolute inset-0 flex items-center justify-center text-gray-500 bg-gray-900 bg-opacity-90 rounded-lg hidden"
						>
							<div class="text-center">
								<i class="fas fa-clipboard-list text-4xl mb-2"></i>
								<p>No logs available</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			document.getElementById("configForm").addEventListener("submit", function (e) {
				e.preventDefault();
				fetch("/update_config", {
					method: "POST",
					body: new FormData(this),
				})
					.then((response) => response.json())
					.then((data) => {
						if (data.status === "success") {
							alert("Configuration updated successfully");
						} else {
							alert("Error: " + data.message);
						}
					})
					.catch((error) => {
						console.error("Error:", error);
						alert("An error occurred while updating the configuration");
					});
			});
			document.getElementById("startScraper").addEventListener("click", function () {
				fetch("/start_scraper", { method: "POST" })
					.then((response) => response.json())
					.then((data) => {
						alert(data.message);
						if (data.status === "success") {
							document.getElementById("scraperStatus").textContent = "Scraper status: Running";
						}
					});
			});

			document.getElementById("stopScraper").addEventListener("click", function () {
				fetch("/stop_scraper", { method: "POST" })
					.then((response) => response.json())
					.then((data) => {
						alert(data.message);
						if (data.status === "success") {
							document.getElementById("scraperStatus").textContent = "Scraper status: Stopped";
						}
					});
			});

			function updateLogs() {
				fetch("/get_logs")
					.then((response) => {
						if (response.status === 304) {
							// Logs haven't changed, do nothing
							return;
						}
						return response.json();
					})
					.then((data) => {
						if (data && data.logs) {
							const logOutput = document.getElementById("logOutput");
							const emptyLogMessage = document.getElementById("emptyLogMessage");

							if (data.logs.trim().length > 0) {
								logOutput.textContent = data.logs;
								logOutput.scrollTop = logOutput.scrollHeight;
								emptyLogMessage.classList.add("hidden");
							} else {
								logOutput.textContent = "";
								emptyLogMessage.classList.remove("hidden");
							}
						}
					});
			}

			// Clear logs function
			function clearLogs() {
				const logOutput = document.getElementById("logOutput");
				const emptyLogMessage = document.getElementById("emptyLogMessage");
				const clearBtn = document.getElementById("clearLogs");

				// Disable button while clearing
				clearBtn.disabled = true;
				clearBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Clearing...</span>';

				fetch("/clear_logs", { method: "POST" })
					.then((response) => response.json())
					.then((data) => {
						if (data.status === "success") {
							logOutput.textContent = "";
							emptyLogMessage.classList.remove("hidden");
						} else {
							console.error("Error clearing logs:", data.message);
						}
					})
					.catch((error) => {
						console.error("Error clearing logs:", error);
					})
					.finally(() => {
						// Re-enable button
						clearBtn.disabled = false;
						clearBtn.innerHTML = '<i class="fas fa-trash-alt"></i><span>Clear</span>';
						// Update logs to show the "Logs cleared" message
						setTimeout(updateLogs, 500);
					});
			}

			// Add event listener for clear logs button
			document.getElementById("clearLogs").addEventListener("click", clearLogs);

			// Update logs every 5 seconds
			setInterval(updateLogs, 5000);

			// Initialize logs on page load
			updateLogs();

			// Global variables
			let allJobs = [];
			let currentPage = 1;
			let itemsPerPage = 20;
			let filteredJobs = [];

			// Function to fetch job data
			function fetchJobs() {
				fetch("/get_jobs")
					.then((response) => response.json())
					.then((data) => {
						if (data.status === "success") {
							allJobs = data.jobs;
							displayJobs(allJobs);
						} else {
							document.getElementById(
								"jobsTableBody"
							).innerHTML = `<tr><td colspan="7" class="py-4 px-4 border-b border-gray-200 text-center">Error: ${data.message}</td></tr>`;
						}
					})
					.catch((error) => {
						console.error("Error:", error);
						document.getElementById("jobsTableBody").innerHTML =
							'<tr><td colspan="7" class="py-4 px-4 border-b border-gray-200 text-center">Error fetching job data</td></tr>';
					});
			}

			// Function to display paginated jobs
			function displayJobs(jobs) {
				// Store filtered jobs for pagination
				filteredJobs = jobs;

				// Reset to first page when filter changes
				currentPage = 1;

				// Display current page
				displayPage();
			}

			// Function to display current page of jobs
			function displayPage() {
				const tableBody = document.getElementById("jobsTableBody");
				tableBody.innerHTML = "";

				if (filteredJobs.length === 0) {
					tableBody.innerHTML =
						'<tr><td colspan="7" class="py-4 px-4 border-b border-gray-200 text-center">No matching jobs found</td></tr>';
					updatePagination(0, 0, 0);
					return;
				}

				// Calculate pagination values
				const totalItems = filteredJobs.length;
				const totalPages = Math.ceil(totalItems / itemsPerPage);
				const startIndex = (currentPage - 1) * itemsPerPage;
				const endIndex = Math.min(startIndex + itemsPerPage, totalItems);

				// Get current page items
				const currentItems = filteredJobs.slice(startIndex, endIndex);

				// Display current page items
				currentItems.forEach((job) => {
					const row = document.createElement("tr");
					row.className = "hover:bg-gray-50";

					// Format the job data
					const isRemote = job.is_remote === true || job.is_remote === "True" ? "Yes" : "No";
					const jobType = job.job_type || "Not specified";

					row.innerHTML = `
                    <td class="py-2 px-4 border-b border-gray-200">${job.title}</td>
                    <td class="py-2 px-4 border-b border-gray-200">${job.company}</td>
                    <td class="py-2 px-4 border-b border-gray-200">${job.location}</td>
                    <td class="py-2 px-4 border-b border-gray-200">${job.date_posted}</td>
                    <td class="py-2 px-4 border-b border-gray-200">${jobType}</td>
                    <td class="py-2 px-4 border-b border-gray-200">${isRemote}</td>
                    <td class="py-2 px-4 border-b border-gray-200">
                        <a href="${job.job_url}" target="_blank" class="text-blue-500 hover:text-blue-700">View Job</a>
                    </td>
                `;

					tableBody.appendChild(row);
				});

				// Update pagination UI
				updatePagination(startIndex + 1, endIndex, totalItems);
			}

			// Function to update pagination UI
			function updatePagination(start, end, total) {
				// Update page info text
				document.getElementById("startItem").textContent = start;
				document.getElementById("endItem").textContent = end;
				document.getElementById("totalItems").textContent = total;

				// Calculate total pages
				const totalPages = Math.ceil(total / itemsPerPage);

				// Update prev/next buttons
				document.getElementById("prevPage").disabled = currentPage <= 1;
				document.getElementById("nextPage").disabled = currentPage >= totalPages;

				// Generate page number buttons
				const pageNumbers = document.getElementById("pageNumbers");
				pageNumbers.innerHTML = "";

				// Determine which page numbers to show
				let startPage = Math.max(1, currentPage - 2);
				let endPage = Math.min(totalPages, startPage + 4);

				// Adjust if we're near the end
				if (endPage - startPage < 4) {
					startPage = Math.max(1, endPage - 4);
				}

				// Add page number buttons
				for (let i = startPage; i <= endPage; i++) {
					const pageButton = document.createElement("button");
					pageButton.className =
						i === currentPage
							? "bg-blue-500 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
							: "bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline";
					pageButton.textContent = i;
					pageButton.addEventListener("click", () => {
						currentPage = i;
						displayPage();
					});
					pageNumbers.appendChild(pageButton);
				}
			}

			// Function to filter and sort jobs
			function filterAndSortJobs() {
				const searchTerm = document.getElementById("searchInput").value.toLowerCase();
				const remoteFilter = document.getElementById("remoteFilter").value;
				const sortBy = document.getElementById("sortBy").value;

				// Filter jobs
				let filteredJobs = allJobs.filter((job) => {
					// Search filter
					const matchesSearch =
						(job.title && job.title.toLowerCase().includes(searchTerm)) ||
						(job.company && job.company.toLowerCase().includes(searchTerm)) ||
						(job.location && job.location.toLowerCase().includes(searchTerm));

					// Remote filter
					let matchesRemote = true;
					if (remoteFilter === "remote") {
						matchesRemote = job.is_remote === true || job.is_remote === "True";
					} else if (remoteFilter === "non-remote") {
						matchesRemote = job.is_remote !== true && job.is_remote !== "True";
					}

					return matchesSearch && matchesRemote;
				});

				// Sort jobs
				filteredJobs.sort((a, b) => {
					switch (sortBy) {
						case "date":
							return new Date(b.date_posted || "1970-01-01") - new Date(a.date_posted || "1970-01-01");
						case "date-asc":
							return new Date(a.date_posted || "1970-01-01") - new Date(b.date_posted || "1970-01-01");
						case "company":
							return (a.company || "").localeCompare(b.company || "");
						case "title":
							return (a.title || "").localeCompare(b.title || "");
						default:
							return 0;
					}
				});

				displayJobs(filteredJobs);
			}

			// Fetch jobs on page load
			fetchJobs();

			// Dark Mode Functionality
			const themeToggle = document.getElementById("themeToggle");
			const body = document.body;
			const prefersDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches;
			const savedTheme = localStorage.getItem("theme");

			// Set initial theme (dark mode is on by default)
			if (savedTheme === "light") {
				body.classList.add("light-mode");
				themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
			} else {
				body.classList.add("dark-mode");
				themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
			}

			// Toggle theme function
			function toggleTheme() {
				if (body.classList.contains("dark-mode")) {
					body.classList.remove("dark-mode");
					body.classList.add("light-mode");
					themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
					localStorage.setItem("theme", "light");
				} else {
					body.classList.remove("light-mode");
					body.classList.add("dark-mode");
					themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
					localStorage.setItem("theme", "dark");
				}
			}

			// Add event listener to theme toggle button
			themeToggle.addEventListener("click", toggleTheme);

			// Add event listeners
			document.getElementById("refreshJobs").addEventListener("click", fetchJobs);
			document.getElementById("searchInput").addEventListener("input", filterAndSortJobs);
			document.getElementById("remoteFilter").addEventListener("change", filterAndSortJobs);
			document.getElementById("sortBy").addEventListener("change", filterAndSortJobs);
			document.getElementById("prevPage").addEventListener("click", () => {
				if (currentPage > 1) {
					currentPage--;
					displayPage();
				}
			});
			document.getElementById("nextPage").addEventListener("click", () => {
				const totalPages = Math.ceil(filteredJobs.length / itemsPerPage);
				if (currentPage < totalPages) {
					currentPage++;
					displayPage();
				}
			});
		</script>
		<!-- Dark Mode Toggle Button -->
		<div id="themeToggle" class="theme-toggle" title="Toggle Dark/Light Mode">
			<i class="fas fa-moon"></i>
		</div>
	</body>
</html>
